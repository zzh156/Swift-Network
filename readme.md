# ğŸš€ åŸºäº Rust çš„æœ‰å‘æ— ç¯å›¾ (DAG) åŒºå—é“¾é¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ Rust æ„å»ºçš„ **æœ‰å‘æ— ç¯å›¾ (DAG)** åŒºå—é“¾é¡¹ç›®ï¼Œæ—¨åœ¨å¸®åŠ©ç†è§£åŒºå—é“¾çš„åŸºç¡€æ¦‚å¿µï¼Œä¾‹å¦‚äº¤æ˜“å¤„ç†ã€èŠ‚ç‚¹ç”Ÿæˆå’Œç®€å•çš„å…±è¯†æœºåˆ¶ã€‚æœ¬é¡¹ç›®ä¸»è¦ç”¨äºå­¦ä¹ å’Œæ¢ç´¢ï¼Œä¹Ÿä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•ï¼ˆä¾‹å¦‚ P2P ç½‘ç»œå’Œæ™ºèƒ½åˆçº¦ï¼‰æ‰“ä¸‹åŸºç¡€ã€‚

---

## âœ¨ é¡¹ç›®ç‰¹ç‚¹

- ğŸŒŸ **æœ‰å‘æ— ç¯å›¾ (DAG)**ï¼šé€šè¿‡èŠ‚ç‚¹é—´çš„å…³ç³»å’Œäº¤æ˜“ï¼Œæ”¯æŒæ›´é«˜æ•ˆçš„äº¤æ˜“å¤„ç†ã€‚
- ğŸ’¸ **äº¤æ˜“å¤„ç†**ï¼šæ”¯æŒç”¨æˆ·é—´çš„äº¤æ˜“ï¼ŒèŠ‚ç‚¹å¯ä»¥è®°å½•å’ŒéªŒè¯äº¤æ˜“ã€‚
- ğŸ¦ **è´¦æˆ·ç®¡ç†**ï¼šç®€å•çš„è´¦æˆ·ç³»ç»Ÿï¼Œæ˜ å°„åœ°å€ä¸ä½™é¢ã€‚
- ğŸ— **DAG ç®¡ç†**ï¼šæ”¯æŒåˆ›ä¸–èŠ‚ç‚¹ç”Ÿæˆã€æ–°èŠ‚ç‚¹åˆ›å»ºåŠé“¾æ¡æ›´æ–°ã€‚
- ğŸŒ **èŠ‚ç‚¹é€šä¿¡**ï¼šæ”¯æŒå¤šèŠ‚ç‚¹é—´é€šè¿‡ TCP è¿›è¡Œé€šä¿¡ï¼Œæ¨¡æ‹Ÿå»ä¸­å¿ƒåŒ–ã€‚
- ğŸ›  **å¯æ‰©å±•æ€§**ï¼šæœªæ¥å°†æ”¯æŒ **P2P ç½‘ç»œ** å’Œ **æ™ºèƒ½åˆçº¦**ã€‚

---

## ğŸ—‚ é¡¹ç›®ç»“æ„

```plaintext
â”œâ”€â”€ block.rs          // DAG èŠ‚ç‚¹ç»“æ„ä½“ï¼ŒåŒ…å«äº¤æ˜“å’Œçˆ¶èŠ‚ç‚¹ä¿¡æ¯
â”œâ”€â”€ blockchain.rs     // DAG æ ¸å¿ƒï¼Œç®¡ç†äº¤æ˜“æ± ã€DAG å’Œè´¦æˆ·ä½™é¢
â”œâ”€â”€ transaction.rs     // äº¤æ˜“ç»“æ„ä½“ï¼Œè®°å½•å‘é€æ–¹ã€æ¥æ”¶æ–¹å’Œäº¤æ˜“é‡‘é¢
â”œâ”€â”€ utils.rs          // å·¥å…·å‡½æ•°ï¼Œè·å–æ—¶é—´æˆ³å’Œè®¡ç®—é»˜å…‹å°”æ ¹
â”œâ”€â”€ main.rs           // ä¸»ç¨‹åºå…¥å£ï¼Œå¯åŠ¨èŠ‚ç‚¹å¹¶è¿è¡Œ DAG é€»è¾‘
ğŸ¯ åŠŸèƒ½è¯¦è§£
ğŸ’¼ äº¤æ˜“ (Transaction)
ä¸€ä¸ªäº¤æ˜“åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

å‘é€æ–¹åœ°å€ (sender)
æ¥æ”¶æ–¹åœ°å€ (receiver)
è½¬è´¦é‡‘é¢ (amount)
ğŸŒŸ ç¤ºä¾‹ä»£ç ï¼š
```
```rust
let transaction = Transaction::new("Alice".to_string(), "Bob".to_string(), 10);
dag.add_transaction(transaction);
```
```plaintext
â›“ DAG èŠ‚ç‚¹ (DagNode)
DAG èŠ‚ç‚¹æ˜¯åŒºå—é“¾çš„åŸºæœ¬å•å…ƒï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

èŠ‚ç‚¹ ID (id)
æ—¶é—´æˆ³ (timestamp)
äº¤æ˜“åˆ—è¡¨ (transactions)
çˆ¶èŠ‚ç‚¹å“ˆå¸Œ (parent_hashes)
é»˜å…‹å°”æ ‘æ ¹å“ˆå¸Œ (merkle_root)
å½“å‰èŠ‚ç‚¹çš„å“ˆå¸Œ (hash)
èŠ‚ç‚¹çš„æƒé‡ (weight)
èŠ‚ç‚¹çš„å“ˆå¸Œé€šè¿‡ä»¥ä¸‹å‡½æ•°è®¡ç®—ï¼š
```

```rust

fn calculate_hash(&self) -> String {
    let node_content = format!(
        "{}{}{}{:?}",
        self.timestamp, self.merkle_root, self.parent_hashes.join(","), self.transactions
    );
    let mut hasher = Sha256::new();
    hasher.update(node_content);
    let result = hasher.finalize();
    hex::encode(result)
}
```
```plaintext
ğŸª™ åˆ›å»ºæ–°èŠ‚ç‚¹
DAG èŠ‚ç‚¹é€šè¿‡èšåˆäº¤æ˜“å¹¶æ›´æ–°è´¦æˆ·ä½™é¢æ¥åˆ›å»ºï¼š
```
```rust
pub fn create_new_node(&mut self) {
    let parent_hashes: Vec<String> = self.graph.keys().cloned().collect();
    let transactions = self.transaction_pool.clone();
    let new_node = DagNode::new(transactions, parent_hashes);

    // æ›´æ–°è´¦æˆ·ä½™é¢
    for tx in &new_node.transactions {
        if tx.sender != "ç³»ç»Ÿå¥–åŠ±" {
            *self.accounts.entry(tx.sender.clone()).or_insert(0) -= tx.amount;
        }
        *self.accounts.entry(tx.receiver.clone()).or_insert(0) += tx.amount;
    }

    // æ¸…ç©ºäº¤æ˜“æ± å¹¶æ·»åŠ æ–°èŠ‚ç‚¹
    self.transaction_pool.clear();
    self.graph.insert(new_node.hash.clone(), new_node);
}
```
```plaintext
ğŸ“¡ èŠ‚ç‚¹é€šä¿¡ (Networking)
æ¯ä¸ªèŠ‚ç‚¹é€šè¿‡ TCP è¿›è¡Œé€šä¿¡ï¼Œèƒ½å¤Ÿæ¥æ”¶æ–°åŒºå—å¹¶å°†å…¶å¹¿æ’­ç»™å…¶ä»–èŠ‚ç‚¹ã€‚

ğŸš€ å¿«é€Ÿå¼€å§‹
1ï¸âƒ£ å…‹éš†é¡¹ç›®ä»£ç 
```
```bash
git clone https://github.com/zzh156/chain.git
cd chain
```
```plaintext
2ï¸âƒ£ æ„å»ºé¡¹ç›®
```
```bash
cargo build
```
3ï¸âƒ£ è¿è¡Œé¡¹ç›®

```bash
cargo run
```
è¿è¡Œåï¼Œå°†ä¼šå¯åŠ¨æœ¬åœ°èŠ‚ç‚¹å¹¶æ¨¡æ‹ŸåŒºå—é“¾æ“ä½œã€‚

ğŸ”® æœªæ¥åŠŸèƒ½
ğŸŒ P2P ç½‘ç»œï¼šæ”¯æŒçœŸæ­£çš„å»ä¸­å¿ƒåŒ–ç½‘ç»œã€‚
ğŸ§  æ™ºèƒ½åˆçº¦ï¼šæ·»åŠ åŸºæœ¬çš„æ™ºèƒ½åˆçº¦åŠŸèƒ½ã€‚
âš¡ï¸ æ€§èƒ½ä¼˜åŒ–ï¼šæå‡åŒºå—é“¾æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚
ğŸ”’ å®‰å…¨å¢å¼ºï¼šé€šè¿‡åŠ å¯†ç®—æ³•æå‡æ•°æ®å®‰å…¨æ€§ã€‚
ğŸ“œ é¡¹ç›®è®¸å¯è¯
æœ¬é¡¹ç›®åŸºäº MIT åè®®ï¼Œæ¬¢è¿å­¦ä¹ å’Œä½¿ç”¨ï¼